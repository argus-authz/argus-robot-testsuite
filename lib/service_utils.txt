** Settings ***

Library    OperatingSystem
Library    Process
Resource   variables.txt

Resource   common_utils.txt

Variables  ${ENV_FILE}

*** Keywords ***

Check port  [Arguments]  ${port}
  ${cmd}=  Set Variable  nmap -Pn -p ${port} `hostname` | grep -q open
  ${rc}=  Run And Return Rc  ${cmd}
  Should Be Equal As Integers  ${rc}  0

Port not reachable  [Arguments]  ${port}
  ${cmd}=  Set Variable  nmap -Pn -p ${port} `hostname` | grep -q open
  ${rc}=  Run And Return Rc  ${cmd}
  Should Be Equal As Integers  ${rc}  1

Restore services
  Stop PAP service
  Stop PDP service
  Stop PEP service
  Sleep  5
  Start PAP service
  Start PDP service
  Start PEP service

Restart PAP service
  Stop PAP service
  Start PAP service

Restart PEP service
  Stop PEP service
  Start PEP service

Start PAP service
  Run Process  systemctl  start  argus-pap
  Wait Until Keyword Succeeds  1 min  2 sec  Check port  ${T_PAP_PORT}
  Log  PAP started
  
Start PDP service
  Run Process  systemctl  start  argus-pdp
  Wait Until Keyword Succeeds  1 min  2 sec  Check port  ${T_PDP_PORT}
  Log  PDP started

Start PEP service
  Run Process  systemctl  start  argus-pepd
  Wait Until Keyword Succeeds  1 min  2 sec  Check port  ${T_PEP_PORT}
  Log  PEP started

Stop PAP service
  Run Process  systemctl  stop  argus-pap
  Wait Until Keyword Succeeds  1 min  2 sec  Port not reachable  ${T_PAP_ADMIN_PORT},${T_PAP_PORT}
  Log  PAP stopped

Stop PDP service
  Run Process  systemctl  stop  argus-pdp
  Wait Until Keyword Succeeds  1 min  2 sec  Port not reachable  ${T_PDP_ADMIN_PORT},${T_PDP_PORT}
  Log  PDP stopped

Stop PEP service
  Run Process  systemctl  stop  argus-pepd
  Wait Until Keyword Succeeds  1 min  2 sec  Port not reachable  ${T_PEP_ADMIN_PORT},${T_PEP_PORT}
  Log  PEP stopped
