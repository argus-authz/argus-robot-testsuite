*** Settings ***
Resource   lib/utils.txt

Suite Setup     Make backup of the configuration
Suite Teardown  Restore configurations

Test Setup     Start PAP service
Test Teardown  Clean up


*** Test Cases ***
Add policy from file
  ${policy}=  Prepare
  Create policy file  ${policy}
  Load policy file

Add policy from file with error
  ${policy}=  Prepare with error
  Create policy file  ${policy}
  Execute and Check Failure  ${PAP_ADMIN} apf ${POLICY_FILE}

DN containing slash (bug 66669)
  Remove all policies
  ${pol}=  catenate  SEPARATOR=
  ...  resource "resource_1" { \n
  ...    action ".*" { \n
  ...      rule deny { subject="/DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=user/CN=999999/CN=user name/testslash" } \n
  ...    } \n
  ...  } \n
  Create policy file  ${pol}
  Load policy file
  Remove policy file
  ${pol}=  catenate  SEPARATOR=
  ...  resource "resource_1" { \n
  ...    action ".*" { \n
  ...      rule permit { subject="/DC=ch/DC=cern/OU=Organic Units/OU=Users/slashtest/CN=user/CN=999999/CN=user name" } \n
  ...    } \n
  ...  } \n
  Create policy file  ${pol}
  Load policy file
  Execute and Check Success  ${PAP_ADMIN} lp --resource ${TEST_RESOURCE}
  

*** Keywords ***
Prepare
  ${policies}=  catenate  SEPARATOR=\n
  ...  resource ".*" {
  ...    action ".*" {
  ...      rule deny { subject="/DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=user/CN=999999/CN=user name" }
  ...    }
  ...  }
  ...  resource ".*" {
  ...    action ".*" {
  ...      rule deny { fqan="/badvo" }
  ...    }
  ...  }
  [Return]  ${policies}

Prepare with error
  ${policies}=  catenate  SEPARATOR=\n
  ...  resource ".*" {
  ...    action ".*" {
  ...      rule deni { subject="/DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=user/CN=999999/CN=user name" }
  ...    }
  ...  }
  [Return]  ${policies}