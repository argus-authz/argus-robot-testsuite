*** Settings ***
Library    OperatingSystem
Resource   lib/utils.txt
Resource   variables.txt


*** Keywords ***

Prepare
  ${policies}=  catenate  SEPARATOR=
  ...  resource "resource_1" { \n
  ...    obligation "http://glite.org/xacml/obligation/local-environment-map" {} \n
  ...    action ".*" { \n
  ...      rule deny { subject="/DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=user/CN=999999/CN=user name" } \n
  ...    } \n
  ...  } \n
  ...  resource "resource_2" { \n
  ...    obligation "http://glite.org/xacml/obligation/local-environment-map" {} \n
  ...    action ".*" { \n
  ...      rule deny { subject="/DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=user/CN=999999/CN=user name" } \n
  ...    } \n
  ...  } \n
  ...  resource "resource_3" { \n
  ...    obligation "http://glite.org/xacml/obligation/local-environment-map" {} \n
  ...    action ".*" { \n
  ...      rule deny { subject="/DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=user/CN=999999/CN=user name" } \n
  ...    } \n
  ...  } \n
  Prepare environment  ${policies}


*** Test Cases ***
List empty repository
  [Setup]  Clean policy repository
  Execute and Check Success  pap-admin lp

List policies
  [Setup]  Prepare
  ${rc}  ${output}=  Run And Return Rc And Output  pap-admin lp -sai | egrep -c 'id='
  Should Be Equal As Integers  ${rc}  0
  Should Be Equal As Integers  ${output}  9
  [Teardown]  Clean up
  
List policies with wrong pap-alias
  Execute And Check Failure  pap-admin lp -sai --pap "dummy_pap"
